name: Daily Global Intelligence Engine

on:
  schedule:
    # UTC 00:00 (åŒ—äº¬æ—¶é—´æ—©ä¸Š 8:00)
    - cron: '0 0 * * *'
  workflow_dispatch:  # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  generate-report:
    runs-on: ubuntu-latest
    
    # ğŸ”¥ å…³é”®ï¼šå¿…é¡»æ·»åŠ  permissions æ‰èƒ½è®¿é—® GitHub Models
    permissions:
      contents: read
      models: read
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
      
      - name: Run Daily Intelligence Engine
        env:
          # é‚®ä»¶é…ç½®ï¼ˆæ¨èä½¿ç”¨ Gmailï¼‰
          # Gmail é…ç½®ï¼šSMTP_HOST=smtp.gmail.com, SMTP_PORT=587
          # éœ€è¦ Gmail åº”ç”¨å¯†ç ï¼ˆ16ä½ï¼Œæ— è¿å­—ç¬¦ï¼‰ï¼Œä¸æ˜¯è´¦æˆ·å¯†ç 
          # è·å–æ–¹æ³•ï¼šhttps://myaccount.google.com/security â†’ åº”ç”¨å¯†ç 
          SMTP_HOST: ${{ secrets.SMTP_HOST }}
          SMTP_PORT: ${{ secrets.SMTP_PORT }}
          SMTP_USER: ${{ secrets.SMTP_USER }}
          SMTP_PASS: ${{ secrets.SMTP_PASS }}
          EMAIL_TO: ${{ secrets.EMAIL_TO }}
          
          # LLM API é…ç½®ï¼ˆä½¿ç”¨ GitHub æä¾›çš„æ¨¡å‹ï¼‰
          # GitHub Actions ä¼šè‡ªåŠ¨æä¾› github.tokenï¼ˆé€šè¿‡ permissions.models: readï¼‰
          # ä¹Ÿå¯ä»¥æ‰‹åŠ¨åœ¨ Secrets ä¸­é…ç½® GITHUB_TOKEN
          # ğŸ”¥ å…³é”®ï¼šå¿…é¡»è®¾ç½® permissions.models: read æ‰èƒ½è®¿é—® GitHub Models
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN || github.token }}
          GITHUB_MODEL_NAME: ${{ secrets.GITHUB_MODEL_NAME || 'gpt-4o-mini' }}
        run: |
          # å¦‚æœæœªé…ç½® GITHUB_TOKEN secretï¼Œä½¿ç”¨ GitHub Actions è‡ªåŠ¨æä¾›çš„ token
          if [ -z "$GITHUB_TOKEN" ]; then
            export GITHUB_TOKEN="${{ github.token }}"
          fi
          # å¦‚æœæœªé…ç½® GITHUB_MODEL_NAMEï¼Œä½¿ç”¨é»˜è®¤å€¼
          if [ -z "$GITHUB_MODEL_NAME" ]; then
            export GITHUB_MODEL_NAME="gpt-4o-mini"
          fi
          python main.py
