# 故障排查指南

## 常见问题及解决方案

### 1. 环境变量配置问题

**问题**：`ValueError: invalid literal for int() with base 10: ''`

**原因**：环境变量为空字符串时，类型转换失败

**解决**：已修复，代码会自动使用默认值

### 2. 邮件发送失败

**检查项**：
- ✅ `SMTP_USER` 是否正确（Gmail 邮箱地址）
- ✅ `SMTP_PASS` 是否为应用密码（16位，无连字符）
- ✅ `EMAIL_TO` 是否正确（支持多个，逗号分隔）
- ✅ Gmail 是否启用了两步验证
- ✅ 应用密码是否有效

### 3. 数据采集失败

**可能原因**：
- 网络连接问题（GitHub Actions 网络限制）
- RSS 源不可用
- API 限流

**解决**：代码已包含异常处理，单个数据源失败不会影响整体运行

### 4. LLM 摘要生成失败

**可能原因**：
- 未配置 Token（`HF_TOKEN` 或 `GITHUB_TOKEN`）
- Hugging Face API 限流
- 模型加载中（503 错误）

**解决**：
- 如果不配置 Token，系统会使用原始内容
- 已实现自动重试和等待机制

### 5. 除零错误（股票数据）

**问题**：计算涨跌幅时可能出现除零错误

**解决**：已添加检查，避免除零错误

### 6. JSON 解析错误

**问题**：`EMAIL_TO` 配置格式错误

**解决**：
- 支持单个邮箱：`email@example.com`
- 支持逗号分隔：`email1@example.com,email2@example.com`
- 支持 JSON 数组：`["email1@example.com","email2@example.com"]`

### 7. 空列表访问错误

**问题**：访问空列表的第一个元素

**解决**：已添加空值检查

## 调试建议

1. **查看 GitHub Actions 日志**
   - 进入 Actions 标签页
   - 点击失败的 workflow
   - 查看详细日志

2. **手动触发测试**
   - 使用 `workflow_dispatch` 手动触发
   - 观察每一步的输出

3. **检查 Secrets 配置**
   - 确认所有必需 Secrets 已配置
   - 确认 Secret 名称正确
   - 确认 Secret 值正确（无多余空格）

4. **本地测试**
   - 在本地环境运行 `python main.py`
   - 使用环境变量或 `.env` 文件配置

## 性能优化

- 数据采集：已实现超时和重试机制
- LLM 摘要：已实现延迟和重试机制
- 邮件发送：支持批量发送

## 联系支持

如果问题持续存在，请：
1. 检查 GitHub Actions 日志
2. 确认所有配置正确
3. 查看错误信息详情

